{"ast":null,"code":"import\"antd/es/card/style/css\";import _Card from\"antd/es/card\";import\"antd/es/table/style/css\";import _Table from\"antd/es/table\";import\"antd/es/icon/style/css\";import _Icon from\"antd/es/icon\";import\"antd/es/input/style/css\";import _Input from\"antd/es/input\";import _regeneratorRuntime from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/regenerator\";import\"antd/es/message/style/css\";import _message from\"antd/es/message\";import _asyncToGenerator from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import\"antd/es/button/style/css\";import _Button from\"antd/es/button\";import _classCallCheck from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/inherits\";import\"antd/es/select/style/css\";import _Select from\"antd/es/select\";import React from'react';import LinkButton from\"../../components/link-button\";import{reqProducts,reqSearchProducts,reqUpdateStatus}from\"../../api\";import{PAGE_SIZE}from\"../../utils/constant\";var Option=_Select.Option;var ProductHome=/*#__PURE__*/function(_React$Component){_inherits(ProductHome,_React$Component);function ProductHome(){var _getPrototypeOf2;var _this;_classCallCheck(this,ProductHome);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(ProductHome)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={products:[],total:0,loading:false,searchName:'',searchType:'productName'};_this.initColumns=function(){_this.columns=[{title:'商品名称',dataIndex:'name',key:'name'},{title:'商品描述',dataIndex:'desc',key:'age'},{title:'价格',dataIndex:'price',render:function render(price){return\"￥\"+price;}},{width:100,title:'状态',render:function render(product){var status=product.status,_id=product._id;return React.createElement(\"span\",null,React.createElement(_Button,{type:\"primary\",onClick:function onClick(){return _this.updateStatus(status===0?1:0,_id);}},status===1?'下架':'上架'),React.createElement(\"span\",null,status===1?'在售':'已下架'));}},{width:100,title:'操作',render:function render(product){return React.createElement(\"span\",null,React.createElement(LinkButton,{onClick:function onClick(){return _this.props.history.push(\"/product/detail\",product);}},\"\\u8BE6\\u60C5\"),React.createElement(LinkButton,{onClick:function onClick(){return _this.props.history.push(\"/product/addupdate\",product);}},\"\\u4FEE\\u6539\"));}}];};_this.updateStatus=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(status,_id){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return reqUpdateStatus(_id,status);case 2:result=_context.sent;if(result.data.status===0){_message.success(\"更新成功\");_this.getProducts(_this.pageNum);}case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();_this.getProducts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(pageNum){var _this$state,searchName,searchType,result,_result$data$data,total,list;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this.pageNum=pageNum;_this.setState({loading:true});_this$state=_this.state,searchName=_this$state.searchName,searchType=_this$state.searchType;if(!searchName){_context2.next=9;break;}_context2.next=6;return reqSearchProducts({pageNum:pageNum,pageSize:PAGE_SIZE,searchName:searchName,searchType:searchType});case 6:result=_context2.sent;_context2.next=12;break;case 9:_context2.next=11;return reqProducts(pageNum,PAGE_SIZE);case 11:result=_context2.sent;case 12:_this.setState({loading:false});console.log(result.data);if(result.data.status===0){_result$data$data=result.data.data,total=_result$data$data.total,list=_result$data$data.list;_this.setState({total:total,products:list});}case 15:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3){return _ref2.apply(this,arguments);};}();return _this;}_createClass(ProductHome,[{key:\"componentWillMount\",value:function componentWillMount(){this.initColumns();}},{key:\"componentDidMount\",value:function componentDidMount(){this.getProducts(1);}},{key:\"render\",value:function render(){var _this2=this;var _this$state2=this.state,products=_this$state2.products,total=_this$state2.total,loading=_this$state2.loading,searchName=_this$state2.searchName,searchType=_this$state2.searchType;var title=React.createElement(\"span\",null,React.createElement(_Select,{value:searchType,style:{width:150},onChange:function onChange(value){return _this2.setState({searchType:value});}},React.createElement(Option,{value:\"productName\"},\"\\u6309\\u540D\\u79F0\\u641C\\u7D22\"),React.createElement(Option,{value:\"productDesc\"},\"\\u6309\\u63CF\\u8FF0\\u641C\\u7D22\")),React.createElement(_Input,{placeholder:\"\\u5173\\u952E\\u5B57\",style:{width:150,margin:'0 15px'},value:searchName,onChange:function onChange(event){return _this2.setState({searchName:event.target.value});}}),React.createElement(_Button,{type:\"primary\",onClick:function onClick(){return _this2.getProducts(1);}},\"\\u641C\\u7D22\"));var extra=React.createElement(_Button,{type:\"primary\",onClick:function onClick(){return _this2.props.history.push(\"/product/addupdate\");}},React.createElement(_Icon,{type:\"plus\"}),\"\\u6DFB\\u52A0\\u5546\\u54C1\");return React.createElement(_Card,{title:title,extra:extra},React.createElement(_Table,{bordered:true,rowKey:\"_id\",loadding:loading,dataSource:products,pagination:{total:total,defaultPageSize:PAGE_SIZE,onChange:this.getProducts},columns:this.columns}));}}]);return ProductHome;}(React.Component);export{ProductHome as default};","map":{"version":3,"sources":["/home/crc/WebstormProjects/react-admin/src/pages/product/home.jsx"],"names":["React","LinkButton","reqProducts","reqSearchProducts","reqUpdateStatus","PAGE_SIZE","Option","ProductHome","state","products","total","loading","searchName","searchType","initColumns","columns","title","dataIndex","key","render","price","width","product","status","_id","updateStatus","props","history","push","result","data","success","getProducts","pageNum","setState","pageSize","console","log","list","value","margin","event","target","extra","defaultPageSize","onChange","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {Table,Card,Select,Input,Button,Icon,message} from \"antd\"\nimport LinkButton from \"../../components/link-button\";\nimport {reqProducts,reqSearchProducts,reqUpdateStatus} from \"../../api\";\nimport {PAGE_SIZE} from \"../../utils/constant\";\n\nconst Option = Select.Option;\n\nexport default class ProductHome extends React.Component {\n\n    state = {\n        products:[],\n        total:0,\n        loading:false,\n        searchName:'',\n        searchType:'productName'\n\n    }\n\n    initColumns = () =>{\n        this.columns = [\n            {\n                title: '商品名称',\n                dataIndex: 'name',\n                key: 'name',\n            },\n            {\n                title: '商品描述',\n                dataIndex: 'desc',\n                key: 'age',\n            },\n            {\n                title: '价格',\n                dataIndex: 'price',\n                render: (price)=>\"￥\"+price,\n            }, {\n                width:100,\n                title: '状态',\n                render: (product)=>{\n                    const {status,_id} = product\n                    return (\n                        <span>\n                            <Button\n                                type=\"primary\"\n                                onClick={()=>this.updateStatus(status===0?1:0,_id)}\n                            >\n                                {status===1?'下架':'上架'}\n                            </Button>\n                        <span>{status===1?'在售':'已下架'}</span>\n                    </span>)\n                },\n            },{\n                width:100,\n                title: '操作',\n                render: (product)=>{\n                    return (\n                        <span>\n                            <LinkButton onClick={()=>this.props.history.push(\"/product/detail\",product)}>详情</LinkButton>\n                            <LinkButton onClick={()=>this.props.history.push(\"/product/addupdate\",product)}>修改</LinkButton>\n                    </span>)\n                },\n            },\n        ];\n    }\n\n    updateStatus = async(status,_id)=>{\n        const result = await reqUpdateStatus(_id,status);\n        if(result.data.status===0){\n            message.success(\"更新成功\")\n            this.getProducts(this.pageNum)\n        }\n    }\n\n    getProducts = async(pageNum) =>{\n        this.pageNum = pageNum;\n        this.setState({loading:true})\n        const {searchName,searchType} = this.state\n        let result;\n        if(searchName){\n             result = await  reqSearchProducts({pageNum,pageSize:PAGE_SIZE,searchName,searchType})\n        }else{\n            result = await reqProducts(pageNum,PAGE_SIZE);\n        }\n\n        this.setState({loading:false})\n        console.log(result.data);\n        if(result.data.status === 0){\n            const {total,list} = result.data.data;\n            this.setState({\n                total,\n                products:list\n            })\n        }\n    }\n\n    componentWillMount() {\n        this.initColumns()\n    }\n\n    componentDidMount() {\n        this.getProducts(1)\n    }\n\n    render(){\n        const {products,total,loading,searchName,searchType} = this.state;\n\n        const title = (\n            <span>\n                <Select value={searchType} style={{width:150}} onChange={value=>this.setState({searchType: value})}>\n                    <Option value=\"productName\">按名称搜索</Option>\n                    <Option value=\"productDesc\">按描述搜索</Option>\n                </Select>\n                <Input placeholder=\"关键字\"\n                       style={{width:150,margin:'0 15px'}}\n                       value={searchName}\n                       onChange={event=>this.setState({searchName:event.target.value})} />\n                <Button type=\"primary\" onClick={()=>this.getProducts(1)}>搜索</Button>\n            </span>);\n\n        const extra = (\n            <Button type=\"primary\" onClick={()=>this.props.history.push(\"/product/addupdate\")}>\n            <Icon type=\"plus\"></Icon>\n            添加商品\n        </Button>);\n\n\n\n\n\n        return (\n            <Card title={title} extra={extra}>\n                <Table\n                    bordered\n                    rowKey=\"_id\"\n                    loadding={loading}\n                    dataSource={products}\n                    pagination={\n                        {\n                            total:total,\n                            defaultPageSize:PAGE_SIZE,\n                            onChange:this.getProducts\n                        }\n                    }\n                    columns={this.columns} />\n            </Card>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}