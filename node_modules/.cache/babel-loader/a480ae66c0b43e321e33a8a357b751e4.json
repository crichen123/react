{"ast":null,"code":"import \"antd/es/card/style/css\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/table/style/css\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style/css\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/modal/style/css\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/message/style/css\";\nimport _message from \"antd/es/message\";\nvar _jsxFileName = \"/home/crc/WebstormProjects/react-admin/src/pages/user/user.jsx\";\nimport React from 'react';\nimport { PAGE_SIZE } from \"../../utils/constant\";\nimport { formateDate } from \"../../utils/dateUtils\";\nimport LinkButton from \"../../components/link-button\";\nimport UserForm from \"./user-form\";\nimport { reqGetUsers, reqDeleUser, reqAddUser } from \"../../api\";\nexport default class User extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      loading: false,\n      users: [{\n        \"username\": \"text\",\n        \"_id\": \"548542421\",\n        \"create_time\": 1554639552758,\n        \"email\": \"test@aadfa.conm\",\n        \"phone\": \"15712548\",\n        \"role_id\": \"fdsa854854\",\n        \"password\": \"12312312\"\n      }],\n      roles: [{\n        \"_id\": \"fdsa854854\",\n        \"name\": \"测试\"\n      }],\n      isShow: false\n    };\n\n    this.initColumn = () => {\n      this.columns = [{\n        title: '用户明',\n        dataIndex: \"username\"\n      }, {\n        title: \"邮箱\",\n        dataIndex: \"email\"\n      }, {\n        title: \"电话\",\n        dataIndex: \"phone\"\n      }, {\n        title: \"注册时间\",\n        dataIndex: \"create_time\",\n        render: formateDate\n      }, {\n        title: \"所属角色\",\n        dataIndex: \"role_id\",\n        render: role_id => this.state.roles.find(role => role._id === role_id).name // render:(role_id)=>this.roleNames[role_id]\n\n      }, {\n        title: \"操作\",\n        render: user => React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 52\n          },\n          __self: this\n        }, React.createElement(LinkButton, {\n          onClick: () => this.showUpdate(user),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 53\n          },\n          __self: this\n        }, \"\\u4FEE\\u6539\"), React.createElement(LinkButton, {\n          onClick: () => this.deleteUser(user),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 54\n          },\n          __self: this\n        }, \"\\u5220\\u9664\"))\n      }];\n    };\n\n    this.showUpdate = user => {\n      this.user = user;\n      this.setState({\n        isShow: true\n      });\n    };\n\n    this.addOrUpdateUser = async () => {\n      this.setState({\n        isshow: false\n      });\n      const user = this.form.getFieldsValue();\n      this.form.resetFields();\n      const result = await reqAddUser(user);\n\n      if (result.static === 0) {\n        _message.success(\"添加成功\");\n\n        this.getUsers();\n      }\n    };\n\n    this.deleteUser = user => {\n      _Modal.confirm({\n        title: \"确定要删除用户\" + user.username + \"?\",\n        onOk: async () => {\n          const result = await reqDeleUser(user._id);\n\n          if (result.status === 0) {\n            _message.success(\"删除用户成功\");\n\n            this.getUsers();\n          }\n        }\n      });\n    };\n\n    this.initRoleNames = roles => {\n      const roleNames = roles.reduce((pre, role) => {\n        pre[role._id] = role.name;\n        return pre;\n      }, []);\n      this.roleNames = roleNames;\n    };\n\n    this.getUsers = async () => {\n      const result = await reqGetUsers();\n\n      if (result.status === 0) {\n        const {\n          users,\n          roles\n        } = result.data;\n        this.initRoleNames(roles);\n        this.setState({\n          users,\n          roles\n        });\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.initColumn();\n    this.getUsers();\n  }\n\n  render() {\n    const title = React.createElement(_Button, {\n      type: \"primary\",\n      onClick: () => this.setState({\n        isShow: true\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, \"\\u521B\\u5EFA\\u7528\\u6237\");\n    const {\n      loading,\n      users,\n      isShow,\n      roles\n    } = this.state;\n    const user = this.user;\n    return React.createElement(_Card, {\n      title: title,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }, React.createElement(_Table, {\n      bordered: true,\n      rowKey: \"_id\",\n      loadding: loading,\n      dataSource: users,\n      pagination: {\n        defaultPageSize: 5\n      },\n      columns: this.columns,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    }), React.createElement(_Modal, {\n      title: user._id ? '修改用户' : \"添加用户\",\n      visible: isShow,\n      onOk: this.addOrUpdateUser,\n      onCancel: () => this.setState({\n        isShow: false\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, React.createElement(UserForm, {\n      user: user,\n      setForm: form => this.form = form,\n      roles: roles,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }, \"1111\")));\n  }\n\n}","map":{"version":3,"sources":["/home/crc/WebstormProjects/react-admin/src/pages/user/user.jsx"],"names":["React","PAGE_SIZE","formateDate","LinkButton","UserForm","reqGetUsers","reqDeleUser","reqAddUser","User","Component","state","loading","users","roles","isShow","initColumn","columns","title","dataIndex","render","role_id","find","role","_id","name","user","showUpdate","deleteUser","setState","addOrUpdateUser","isshow","form","getFieldsValue","resetFields","result","static","success","getUsers","confirm","username","onOk","status","initRoleNames","roleNames","reduce","pre","data","componentDidMount","defaultPageSize"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {Modal, Card, Button, Table, message} from \"antd\"\nimport {PAGE_SIZE} from \"../../utils/constant\";\nimport {formateDate} from \"../../utils/dateUtils\";\nimport LinkButton from \"../../components/link-button\";\nimport UserForm from \"./user-form\";\nimport {reqGetUsers,reqDeleUser,reqAddUser} from \"../../api\"\n\nexport default class User extends React.Component {\n\n    state = {\n        loading:false,\n        users:[{\n            \"username\":\"text\",\n            \"_id\":\"548542421\",\n            \"create_time\":1554639552758,\n            \"email\":\"test@aadfa.conm\",\n            \"phone\":\"15712548\",\n            \"role_id\":\"fdsa854854\",\n            \"password\":\"12312312\"\n        }],\n        roles:[{\n            \"_id\":\"fdsa854854\",\n            \"name\":\"测试\"\n        }],\n        isShow:false,\n\n    }\n\n    initColumn = ()=>{\n        this.columns = [{\n            title:'用户明',\n            dataIndex:\"username\"\n        },{\n            title:\"邮箱\",\n            dataIndex: \"email\"\n        },{\n            title:\"电话\",\n            dataIndex: \"phone\"\n        },{\n            title:\"注册时间\",\n            dataIndex: \"create_time\",\n            render:formateDate\n        },{\n            title:\"所属角色\",\n            dataIndex: \"role_id\",\n           render:(role_id)=>this.state.roles.find(role=>role._id === role_id).name\n           // render:(role_id)=>this.roleNames[role_id]\n        },{\n            title:\"操作\",\n           render:(user)=>(\n            <span>\n                <LinkButton onClick={()=>this.showUpdate(user)}>修改</LinkButton>\n                <LinkButton onClick={()=>this.deleteUser(user)}>删除</LinkButton>\n            </span>\n           )\n        }\n        ]\n    }\n\n    showUpdate = (user) =>{\n        this.user = user\n        this.setState({isShow:true})\n    }\n\n    addOrUpdateUser = async() =>{\n        this.setState({isshow:false})\n        const user = this.form.getFieldsValue()\n        this.form.resetFields()\n        const result = await  reqAddUser(user);\n        if(result.static === 0) {\n            message.success(\"添加成功\")\n            this.getUsers()\n        }\n\n    }\n\n    deleteUser =(user) =>{\n        Modal.confirm({\n            title:\"确定要删除用户\"+user.username+\"?\",\n            onOk:async()=>{\n                const result =await reqDeleUser(user._id)\n                if(result.status === 0){\n                    message.success(\"删除用户成功\")\n                    this.getUsers()\n                }\n            }\n        })\n    }\n\n    initRoleNames = (roles) => {\n        const  roleNames = roles.reduce((pre,role)=>{\n            pre[role._id] = role.name\n            return pre\n        },[])\n        this.roleNames = roleNames\n    }\n\n    getUsers = async() => {\n        const result = await reqGetUsers();\n        if(result.status === 0){\n            const {users,roles} = result.data\n            this.initRoleNames(roles)\n            this.setState({\n                users,roles\n            })\n        }\n\n    }\n\n\n    componentDidMount() {\n        this.initColumn()\n        this.getUsers()\n    }\n\n    render(){\n        const title = (<Button type=\"primary\" onClick={()=>this.setState({isShow: true})}>创建用户</Button>);\n        const {loading,users,isShow,roles} = this.state\n        const user = this.user\n        return (\n\n            <Card title={title}>\n                <Table\n                    bordered\n                    rowKey=\"_id\"\n                    loadding={loading}\n                    dataSource={users}\n                    pagination={ {defaultPageSize:5} }\n                    columns={this.columns} />\n                <Modal\n                    title={user._id?'修改用户':\"添加用户\"}\n                    visible={isShow}\n                    onOk={this.addOrUpdateUser}\n                    onCancel={()=>this.setState({isShow: false})}\n                >\n                    <UserForm user={user} setForm={form=>this.form = form} roles={roles}>1111</UserForm>\n                </Modal>\n\n\n            </Card>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}