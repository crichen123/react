{"ast":null,"code":"import\"antd/es/card/style/css\";import _Card from\"antd/es/card\";import\"antd/es/button/style/css\";import _Button from\"antd/es/button\";import\"antd/es/cascader/style/css\";import _Cascader from\"antd/es/cascader\";import\"antd/es/icon/style/css\";import _Icon from\"antd/es/icon\";import _toConsumableArray from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/regenerator\";import\"antd/es/message/style/css\";import _message from\"antd/es/message\";import _asyncToGenerator from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/inherits\";import\"antd/es/input/style/css\";import _Input from\"antd/es/input\";import\"antd/es/form/style/css\";import _Form from\"antd/es/form\";import React from'react';import LinkButton from\"../../components/link-button\";import{reqCategorys}from\"../../api\";import category from\"../category/category\";import PicturesWall from\"./Pictures-wall\";import RichTextEditor from\"./rich-text-editor\";import{reqAddOrUpdateProduct}from\"../../api/index\";var Item=_Form.Item;var TextArea=_Input.TextArea;var options=[{value:'zhejiang',label:'Zhejiang',isLeaf:false},{value:'jiangsu',label:'Jiangsu',isLeaf:false},{value:'jiangsu2',label:'Jiangsu2',isLeaf:true}];var ProductAddUpdate=/*#__PURE__*/function(_React$Component){_inherits(ProductAddUpdate,_React$Component);function ProductAddUpdate(props){var _this;_classCallCheck(this,ProductAddUpdate);_this=_possibleConstructorReturn(this,_getPrototypeOf(ProductAddUpdate).call(this));_this.state={options:[]};_this.submit=function(){_this.props.form.validateFields(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(err,values){var name,desc,price,categoryIds,pCategoryId,categoryId,imgs,detail,product,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(err){_context.next=11;break;}name=values.name,desc=values.desc,price=values.price,categoryIds=values.categoryIds;if(categoryIds.length===1){pCategoryId='0';categoryId=categoryIds[0];}else{pCategoryId=categoryIds[0];categoryId=categoryIds[1];}imgs=_this.pw.current.getImgs();detail=_this.editor.current.getDetail();product={name:name,desc:desc,price:price,imgs:imgs,detail:detail,pCategoryId:pCategoryId,categoryId:categoryId};if(_this.isUpdate){product._id=_this.product._id;}_context.next=9;return reqAddOrUpdateProduct(product);case 9:result=_context.sent;if(result.status===0){_message.success(\"\".concat(_this.isUpdate,\"? '\\u66F4\\u65B0:'\\u6DFB\\u52A0'\\u5546\\u54C1\\u6210\\u529F!\"));_this.props.history.goBack();}else{_message.error(\"\".concat(_this.isUpdate,\"? '\\u66F4\\u65B0:'\\u6DFB\\u52A0'\\u5546\\u54C1\\u5931\\u8D25!\"));}case 11:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}());};_this.validattorPrice=function(rule,value,callback){if(value*1>0){callback();}else{callback(\"价格格式不对\");}};_this.getCategory=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(parentId){var result,categorys;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return reqCategorys(parentId);case 2:result=_context2.sent;console.log(result.data.status);if(!(result.data.status===\"0\")){_context2.next=11;break;}categorys=result.data.data;if(!(parentId===\"0\")){_context2.next=10;break;}_this.initOptions(categorys);_context2.next=11;break;case 10:return _context2.abrupt(\"return\",categorys);case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3){return _ref2.apply(this,arguments);};}();_this.initOptions=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(catagerys){var options,_assertThisInitialize,isUpdate,product,pCategoryId,categoryId,subCategorys,childOptions,targetOption;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:options=catagerys.map(function(c){return{value:c._id,label:c.name,isLeaf:false};});_assertThisInitialize=_assertThisInitialized(_this),isUpdate=_assertThisInitialize.isUpdate,product=_assertThisInitialize.product;pCategoryId=product.pCategoryId,categoryId=product.categoryId;if(!(isUpdate&&pCategoryId!=='0')){_context3.next=10;break;}_context3.next=6;return _this.getCategory(pCategoryId);case 6:subCategorys=_context3.sent;childOptions=subCategorys.map(function(c){return{value:c._id,label:c.name,isLeaf:false};});targetOption=options.find(function(option){return option.value==pCategoryId;});targetOption.children=childOptions;case 10:console.log(options);_this.setState({options:options});case 12:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x4){return _ref3.apply(this,arguments);};}();_this.loadData=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(selectedOptions){var targetOption,subCategory,childOptions;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:targetOption=selectedOptions[0];targetOption.loading=true;_context4.next=4;return _this.getCategory(targetOption.value);case 4:subCategory=_context4.sent;targetOption.loading=false;if(subCategory&&subCategory.length>0){childOptions=subCategory.map(function(c){return{value:c._id,label:c.name,isLeaf:true};});targetOption.children=childOptions;}else{targetOption.isLeaf=true;}// setTimeout(() => {\n//     targetOption.loading = false;\n//     targetOption.children = [\n//         {\n//             label: `${targetOption.label} Dynamic 1`,\n//             value: 'dynamic1',\n//         },\n//         {\n//             label: `${targetOption.label} Dynamic 2`,\n//             value: 'dynamic2',\n//         },\n//     ];\n_this.setState({options:_toConsumableArray(_this.state.options)});// }, 1000);\ncase 8:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x5){return _ref4.apply(this,arguments);};}();_this.pw=React.createRef();_this.editor=React.createRef();return _this;}_createClass(ProductAddUpdate,[{key:\"componentDidMount\",value:function componentDidMount(){this.getCategory('0');}},{key:\"componentWillMount\",value:function componentWillMount(){var product=this.props.location.state;this.isUpdate=!!product;this.product=product||{};}},{key:\"render\",value:function render(){var _this2=this;var getFieldDecorator=this.props.form.getFieldDecorator;var isUpdate=this.isUpdate,product=this.product;var pCategoryId=product.pCategoryId,categoryId=product.categoryId,imgs=product.imgs,detail=product.detail;var categoryIds=[];if(isUpdate){if(pCategoryId==='0'){categoryIds.push(categoryId);}else{categoryIds.push(pCategoryId);categoryIds.push(categoryId);}}var title=React.createElement(\"span\",null,React.createElement(LinkButton,{onClick:function onClick(){return _this2.props.history.goBack();}},React.createElement(_Icon,{type:\"arrow-left\",style:{fontSize:20}})),React.createElement(\"span\",null,isUpdate?'修改商品':'添加商品'));var formItemLayout={labelCol:{span:2},wrapperCol:{span:8}};return React.createElement(_Card,{title:title},React.createElement(_Form,formItemLayout,React.createElement(Item,{label:\"\\u5546\\u54C1\\u540D\\u79F0:\"},getFieldDecorator('name',{initialValue:product.name,rules:[{required:true,message:\"请输入商品名称\"}]})(React.createElement(_Input,{placeholder:\"\\u5546\\u54C1\\u540D\\u79F0\"}))),React.createElement(Item,{label:\"\\u5546\\u54C1\\u63CF\\u8FF0:\"},getFieldDecorator('desc',{initialValue:product.desc,rules:[{required:true,message:\"请输入商品描述\"}]})(React.createElement(TextArea,{placeholder:\"\\u5546\\u54C1\\u63CF\\u8FF0\",autoSize:{minRows:2}}))),React.createElement(Item,{label:\"\\u5546\\u54C1\\u4EF7\\u683C:\"},getFieldDecorator('price',{initialValue:product.price,rules:[{required:true,message:\"请输入商品描述\"},{validator:this.validattorPrice}]})(React.createElement(_Input,{type:\"number\",addonAfter:\"\\u5143\",placeholder:\"\\u5546\\u54C1\\u4EF7\\u683C\"}))),React.createElement(Item,{label:\"\\u5546\\u54C1\\u5206\\u7C7B:\"},React.createElement(\"div\",null,\"\\u5546\\u54C1\\u5206\\u7C7B\")),React.createElement(Item,{label:\"\\u5546\\u54C1\\u5206\\u7C7B:\"},getFieldDecorator('categoryIds',{initialValue:categoryIds,rules:[{required:true,message:\"请输入商品分类\"}]})(React.createElement(_Cascader,{options:this.state.options,loadData:this.loadData,onChange:this.onChange,changeOnSelect:true}))),React.createElement(Item,{label:\"\\u5546\\u54C1\\u56FE\\u7247:\"},React.createElement(PicturesWall,{ref:this.pw,imgs:imgs})),React.createElement(Item,{label:\"\\u5546\\u54C1\\u8BE6\\u60C5:\",labelCol:{span:2},wrapperCol:{span:20}},React.createElement(RichTextEditor,{ref:this.editor,detail:detail})),React.createElement(Item,null,React.createElement(_Button,{type:\"primary\",onClick:this.submit},\"\\u63D0\\u4EA4\"))));}}]);return ProductAddUpdate;}(React.Component);export default _Form.create()(ProductAddUpdate);","map":{"version":3,"sources":["/home/crc/WebstormProjects/react-admin/src/pages/product/add-update.jsx"],"names":["React","LinkButton","reqCategorys","category","PicturesWall","RichTextEditor","reqAddOrUpdateProduct","Item","TextArea","options","value","label","isLeaf","ProductAddUpdate","props","state","submit","form","validateFields","err","values","name","desc","price","categoryIds","length","pCategoryId","categoryId","imgs","pw","current","getImgs","detail","editor","getDetail","product","isUpdate","_id","result","status","success","history","goBack","error","validattorPrice","rule","callback","getCategory","parentId","console","log","data","categorys","initOptions","catagerys","map","c","subCategorys","childOptions","targetOption","find","option","children","setState","loadData","selectedOptions","loading","subCategory","createRef","location","getFieldDecorator","push","title","fontSize","formItemLayout","labelCol","span","wrapperCol","initialValue","rules","required","message","minRows","validator","onChange","Component","create"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {Card,Form,Input,Cascader,Button,Icon,message} from \"antd\"\nimport LinkButton from \"../../components/link-button\";\nimport {reqCategorys} from \"../../api\"\nimport category from \"../category/category\";\nimport PicturesWall from \"./Pictures-wall\";\nimport RichTextEditor from \"./rich-text-editor\";\nimport {reqAddOrUpdateProduct} from \"../../api/index\"\n\nconst {Item} = Form\nconst {TextArea} = Input\n\nconst options = [\n    {\n        value: 'zhejiang',\n        label: 'Zhejiang',\n        isLeaf: false,\n    },\n    {\n        value: 'jiangsu',\n        label: 'Jiangsu',\n        isLeaf: false,\n    },\n    {\n        value: 'jiangsu2',\n        label: 'Jiangsu2',\n        isLeaf: true,\n    },\n];\n\nclass ProductAddUpdate extends React.Component {\n\n    state = {\n        options:[],\n    };\n\n    constructor(props) {\n        super();\n        this.pw = React.createRef()\n        this.editor =React.createRef()\n    }\n\n    submit = () =>{\n        this.props.form.validateFields(async (err,values)=>{\n            if(!err){\n                const {name,desc,price,categoryIds} =values\n                let pCategoryId,categoryId\n                if(categoryIds.length ===1){\n                    pCategoryId = '0'\n                    categoryId =categoryIds[0]\n                }else{\n                    pCategoryId = categoryIds[0]\n                    categoryId = categoryIds[1]\n                }\n\n                const imgs = this.pw.current.getImgs()\n                const detail = this.editor.current.getDetail()\n                const product = {name,desc,price,imgs,detail,pCategoryId,categoryId}\n                if(this.isUpdate){\n                    product._id = this.product._id\n                }\n                const result = await reqAddOrUpdateProduct(product)\n                if(result.status === 0){\n                    message.success(`${this.isUpdate}? '更新:'添加'商品成功!`)\n                    this.props.history.goBack()\n                }else{\n                    message.error(`${this.isUpdate}? '更新:'添加'商品失败!`)\n                }\n            }\n        })\n    }\n\n    validattorPrice = (rule,value,callback) =>{\n        if(value*1>0){\n            callback()\n        }else{\n            callback(\"价格格式不对\")\n        }\n\n    }\n\n    getCategory = async(parentId) =>{\n        const result  = await reqCategorys(parentId)\n        console.log(result.data.status);\n        if(result.data.status === \"0\"){\n            const categorys = result.data.data\n            if(parentId === \"0\"){\n                this.initOptions(categorys)\n            }else{\n                return categorys\n            }\n\n        }\n    }\n\n    initOptions =async (catagerys) =>{\n       const options = catagerys.map(c=>({\n            value: c._id,\n            label: c.name,\n            isLeaf: false,\n        }))\n\n        const {isUpdate,product} = this\n        const {pCategoryId,categoryId} =product\n        if(isUpdate && pCategoryId !== '0'){\n           const subCategorys = await this.getCategory(pCategoryId)\n            const childOptions = subCategorys.map(c=>({\n                value: c._id,\n                label: c.name,\n                isLeaf: false,\n            }))\n            const targetOption = options.find(option=>option.value == pCategoryId)\n            targetOption.children = childOptions\n\n        }\n        console.log(options)\n        this.setState({\n            options\n        })\n\n    }\n\n\n    loadData =  async selectedOptions => {\n        const targetOption = selectedOptions[0];\n        targetOption.loading = true;\n\n        const subCategory =  await this.getCategory(targetOption.value)\n        targetOption.loading = false;\n        if(subCategory && subCategory.length>0){\n               const childOptions = subCategory.map(c=>({\n                    value: c._id,\n                    label: c.name,\n                    isLeaf: true,\n                }))\n            targetOption.children = childOptions\n        }else{\n            targetOption.isLeaf = true;\n        }\n        // setTimeout(() => {\n        //     targetOption.loading = false;\n        //     targetOption.children = [\n        //         {\n        //             label: `${targetOption.label} Dynamic 1`,\n        //             value: 'dynamic1',\n        //         },\n        //         {\n        //             label: `${targetOption.label} Dynamic 2`,\n        //             value: 'dynamic2',\n        //         },\n        //     ];\n            this.setState({\n                options: [...this.state.options],\n            });\n        // }, 1000);\n    };\n\n\n    componentDidMount() {\n        this.getCategory('0')\n    }\n\n    componentWillMount() {\n        const product = this.props.location.state\n        this.isUpdate = !!product\n        this.product = product || {}\n    }\n\n\n    render(){\n        const {getFieldDecorator } = this.props.form\n        const {isUpdate,product} = this\n        const {pCategoryId,categoryId,imgs,detail} = product\n        const categoryIds = [];\n\n        if(isUpdate){\n            if(pCategoryId === '0'){\n                categoryIds.push(categoryId)\n            }else{\n                categoryIds.push(pCategoryId)\n                categoryIds.push(categoryId)\n            }\n\n        }\n\n        const title = (\n            <span>\n                <LinkButton onClick={()=>this.props.history.goBack()}>\n                    <Icon type=\"arrow-left\" style={{fontSize:20}}/>\n                </LinkButton>\n                <span>{isUpdate?'修改商品':'添加商品'}</span>\n            </span>\n        )\n\n        const formItemLayout = {\n            labelCol: { span: 2 },\n            wrapperCol: { span: 8},\n        };\n\n\n        return (\n            <Card title={title}>\n                <Form {...formItemLayout}>\n                    <Item label=\"商品名称:\">\n                        {\n                            getFieldDecorator('name',{\n                                initialValue:product.name,\n                                rules:[\n                                    {required:true,message:\"请输入商品名称\"}\n                                ]\n                            })(\n                                <Input placeholder=\"商品名称\"></Input>\n                            )\n                        }\n                    </Item>\n                    <Item label=\"商品描述:\">\n                        {\n                            getFieldDecorator('desc',{\n                                initialValue:product.desc,\n                                rules:[\n                                    {required:true,message:\"请输入商品描述\"}\n                                ]\n                            })(\n                                <TextArea  placeholder=\"商品描述\" autoSize ={{minRows:2}} />\n                            )\n                        }\n\n                    </Item>\n                    <Item label=\"商品价格:\">\n                        {\n                            getFieldDecorator('price',{\n                                initialValue:product.price,\n                                rules:[\n                                    {required:true,message:\"请输入商品描述\"},\n                                    {validator:this.validattorPrice}\n                                ]\n                            })(\n                                <Input type=\"number\" addonAfter=\"元\" placeholder=\"商品价格\"></Input>\n                            )\n                        }\n                    </Item>\n                    <Item label=\"商品分类:\">\n                        <div>商品分类</div>\n                    </Item>\n                    <Item label=\"商品分类:\">\n                        {\n                            getFieldDecorator('categoryIds',{\n                                initialValue:categoryIds,\n                                rules:[\n                                    {required:true,message:\"请输入商品分类\"}\n                                ]\n                            })(\n                                <Cascader\n                                    options={this.state.options}\n                                    loadData={this.loadData}\n                                    onChange={this.onChange}\n                                    changeOnSelect\n                                />\n                            )\n                        }\n\n\n                    </Item>\n                    <Item label=\"商品图片:\">\n                        <PicturesWall  ref={this.pw} imgs ={imgs} />\n                    </Item>\n                    <Item label=\"商品详情:\" labelCol={{ span: 2 }} wrapperCol={{ span: 20}}>\n                        <RichTextEditor  ref={this.editor} detail={detail} />\n                    </Item>\n\n                    <Item>\n                        <Button type=\"primary\" onClick={this.submit}>提交</Button>\n                    </Item>\n                </Form>\n            </Card>\n        )\n    }\n}\n\nexport default Form.create()(ProductAddUpdate);"]},"metadata":{},"sourceType":"module"}