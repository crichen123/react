{"ast":null,"code":"import \"antd/es/card/style/css\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/button/style/css\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/cascader/style/css\";\nimport _Cascader from \"antd/es/cascader\";\nimport \"antd/es/icon/style/css\";\nimport _Icon from \"antd/es/icon\";\nimport \"antd/es/message/style/css\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/input/style/css\";\nimport _Input from \"antd/es/input\";\nimport \"antd/es/form/style/css\";\nimport _Form from \"antd/es/form\";\nvar _jsxFileName = \"/home/crc/WebstormProjects/react-admin/src/pages/product/add-update.jsx\";\nimport React from 'react';\nimport LinkButton from \"../../components/link-button\";\nimport { reqCategorys } from \"../../api\";\nimport category from \"../category/category\";\nimport PicturesWall from \"./Pictures-wall\";\nimport RichTextEditor from \"./rich-text-editor\";\nimport { reqAddOrUpdateProduct } from \"../../api/index\";\nconst {\n  Item\n} = _Form;\nconst {\n  TextArea\n} = _Input;\nconst options = [{\n  value: 'zhejiang',\n  label: 'Zhejiang',\n  isLeaf: false\n}, {\n  value: 'jiangsu',\n  label: 'Jiangsu',\n  isLeaf: false\n}, {\n  value: 'jiangsu2',\n  label: 'Jiangsu2',\n  isLeaf: true\n}];\n\nclass ProductAddUpdate extends React.Component {\n  constructor(props) {\n    super();\n    this.state = {\n      options: []\n    };\n\n    this.submit = () => {\n      this.props.form.validateFields(async (err, values) => {\n        if (!err) {\n          const {\n            name,\n            desc,\n            price,\n            categoryIds\n          } = values;\n          let pCategoryId, categoryId;\n\n          if (categoryIds.length === 1) {\n            pCategoryId = '0';\n            categoryId = categoryIds[0];\n          } else {\n            pCategoryId = categoryIds[0];\n            categoryId = categoryIds[1];\n          }\n\n          const imgs = this.pw.current.getImgs();\n          const detail = this.editor.current.getDetail();\n          const product = {\n            name,\n            desc,\n            price,\n            imgs,\n            detail\n          };\n\n          if (this.isUpdate) {\n            product._id = this.product._id;\n          }\n\n          const result = await reqAddOrUpdateProduct(product);\n\n          if (result.status === 0) {\n            _message.success(`${this.isUpdate}? '更新:'添加'商品成功!`);\n\n            this.props.history.goBack();\n          } else {\n            _message.error(`${this.isUpdate}? '更新:'添加'商品失败!`);\n          }\n        }\n      });\n    };\n\n    this.validattorPrice = (rule, value, callback) => {\n      if (value * 1 > 0) {\n        callback();\n      } else {\n        callback(\"价格格式不对\");\n      }\n    };\n\n    this.getCategory = async parentId => {\n      const result = await reqCategorys(parentId);\n      console.log(result.data.status);\n\n      if (result.data.status === \"0\") {\n        const categorys = result.data.data;\n\n        if (parentId === \"0\") {\n          this.initOptions(categorys);\n        } else {\n          return categorys;\n        }\n      }\n    };\n\n    this.initOptions = async catagerys => {\n      const options = catagerys.map(c => ({\n        value: c._id,\n        label: c.name,\n        isLeaf: false\n      }));\n      const {\n        isUpdate,\n        product\n      } = this;\n      const {\n        pCategoryId,\n        categoryId\n      } = product;\n\n      if (isUpdate && pCategoryId !== '0') {\n        const subCategorys = await this.getCategory(pCategoryId);\n        const childOptions = subCategorys.map(c => ({\n          value: c._id,\n          label: c.name,\n          isLeaf: false\n        }));\n        const targetOption = options.find(option => option.value == pCategoryId);\n        targetOption.children = childOptions;\n      }\n\n      console.log(options);\n      this.setState({\n        options\n      });\n    };\n\n    this.loadData = async selectedOptions => {\n      const targetOption = selectedOptions[0];\n      targetOption.loading = true;\n      const subCategory = await this.getCategory(targetOption.value);\n      targetOption.loading = false;\n\n      if (subCategory && subCategory.length > 0) {\n        const childOptions = subCategory.map(c => ({\n          value: c._id,\n          label: c.name,\n          isLeaf: true\n        }));\n        targetOption.children = childOptions;\n      } else {\n        targetOption.isLeaf = true;\n      } // setTimeout(() => {\n      //     targetOption.loading = false;\n      //     targetOption.children = [\n      //         {\n      //             label: `${targetOption.label} Dynamic 1`,\n      //             value: 'dynamic1',\n      //         },\n      //         {\n      //             label: `${targetOption.label} Dynamic 2`,\n      //             value: 'dynamic2',\n      //         },\n      //     ];\n\n\n      this.setState({\n        options: [...this.state.options]\n      }); // }, 1000);\n    };\n\n    this.pw = React.createRef();\n    this.editor = React.createRef();\n  }\n\n  componentDidMount() {\n    this.getCategory('0');\n  }\n\n  componentWillMount() {\n    const product = this.props.location.state;\n    this.isUpdate = !!product;\n    this.product = product || {};\n  }\n\n  render() {\n    const {\n      getFieldDecorator\n    } = this.props.form;\n    const {\n      isUpdate,\n      product\n    } = this;\n    const {\n      pCategoryId,\n      categoryId,\n      imgs,\n      detail\n    } = product;\n    const categoryIds = [];\n\n    if (isUpdate) {\n      if (pCategoryId === '0') {\n        categoryIds.push(categoryId);\n      } else {\n        categoryIds.push(pCategoryId);\n        categoryIds.push(categoryId);\n      }\n    }\n\n    const title = React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    }, React.createElement(LinkButton, {\n      onClick: () => this.props.history.goBack(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188\n      },\n      __self: this\n    }, React.createElement(_Icon, {\n      type: \"arrow-left\",\n      style: {\n        fontSize: 20\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    })), React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191\n      },\n      __self: this\n    }, isUpdate ? '修改商品' : '添加商品'));\n    const formItemLayout = {\n      labelCol: {\n        span: 2\n      },\n      wrapperCol: {\n        span: 8\n      }\n    };\n    return React.createElement(_Card, {\n      title: title,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }, React.createElement(_Form, Object.assign({}, formItemLayout, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u540D\\u79F0:\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }, getFieldDecorator('name', {\n      initialValue: product.name,\n      rules: [{\n        required: true,\n        message: \"请输入商品名称\"\n      }]\n    })(React.createElement(_Input, {\n      placeholder: \"\\u5546\\u54C1\\u540D\\u79F0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    }))), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u63CF\\u8FF0:\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    }, getFieldDecorator('desc', {\n      initialValue: product.desc,\n      rules: [{\n        required: true,\n        message: \"请输入商品描述\"\n      }]\n    })(React.createElement(TextArea, {\n      placeholder: \"\\u5546\\u54C1\\u63CF\\u8FF0\",\n      autoSize: {\n        minRows: 2\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224\n      },\n      __self: this\n    }))), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u4EF7\\u683C:\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, getFieldDecorator('price', {\n      initialValue: product.price,\n      rules: [{\n        required: true,\n        message: \"请输入商品描述\"\n      }, {\n        validator: this.validattorPrice\n      }]\n    })(React.createElement(_Input, {\n      type: \"number\",\n      addonAfter: \"\\u5143\",\n      placeholder: \"\\u5546\\u54C1\\u4EF7\\u683C\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    }))), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u5206\\u7C7B:\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243\n      },\n      __self: this\n    }, \"\\u5546\\u54C1\\u5206\\u7C7B\")), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u5206\\u7C7B:\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }, getFieldDecorator('categoryIds', {\n      initialValue: categoryIds,\n      rules: [{\n        required: true,\n        message: \"请输入商品分类\"\n      }]\n    })(React.createElement(_Cascader, {\n      options: this.state.options,\n      loadData: this.loadData,\n      onChange: this.onChange,\n      changeOnSelect: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253\n      },\n      __self: this\n    }))), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u56FE\\u7247:\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264\n      },\n      __self: this\n    }, React.createElement(PicturesWall, {\n      ref: this.pw,\n      imgs: imgs,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    })), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u8BE6\\u60C5:\",\n      labelCol: {\n        span: 2\n      },\n      wrapperCol: {\n        span: 20\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267\n      },\n      __self: this\n    }, React.createElement(RichTextEditor, {\n      ref: this.editor,\n      detail: detail,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268\n      },\n      __self: this\n    })), React.createElement(Item, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271\n      },\n      __self: this\n    }, React.createElement(_Button, {\n      type: \"primary\",\n      onClick: this.submit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272\n      },\n      __self: this\n    }, \"\\u63D0\\u4EA4\"))));\n  }\n\n}\n\nexport default _Form.create()(ProductAddUpdate);","map":{"version":3,"sources":["/home/crc/WebstormProjects/react-admin/src/pages/product/add-update.jsx"],"names":["React","LinkButton","reqCategorys","category","PicturesWall","RichTextEditor","reqAddOrUpdateProduct","Item","TextArea","options","value","label","isLeaf","ProductAddUpdate","Component","constructor","props","state","submit","form","validateFields","err","values","name","desc","price","categoryIds","pCategoryId","categoryId","length","imgs","pw","current","getImgs","detail","editor","getDetail","product","isUpdate","_id","result","status","success","history","goBack","error","validattorPrice","rule","callback","getCategory","parentId","console","log","data","categorys","initOptions","catagerys","map","c","subCategorys","childOptions","targetOption","find","option","children","setState","loadData","selectedOptions","loading","subCategory","createRef","componentDidMount","componentWillMount","location","render","getFieldDecorator","push","title","fontSize","formItemLayout","labelCol","span","wrapperCol","initialValue","rules","required","message","minRows","validator","onChange","create"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {Card,Form,Input,Cascader,Button,Icon,message} from \"antd\"\nimport LinkButton from \"../../components/link-button\";\nimport {reqCategorys} from \"../../api\"\nimport category from \"../category/category\";\nimport PicturesWall from \"./Pictures-wall\";\nimport RichTextEditor from \"./rich-text-editor\";\nimport {reqAddOrUpdateProduct} from \"../../api/index\"\n\nconst {Item} = Form\nconst {TextArea} = Input\n\nconst options = [\n    {\n        value: 'zhejiang',\n        label: 'Zhejiang',\n        isLeaf: false,\n    },\n    {\n        value: 'jiangsu',\n        label: 'Jiangsu',\n        isLeaf: false,\n    },\n    {\n        value: 'jiangsu2',\n        label: 'Jiangsu2',\n        isLeaf: true,\n    },\n];\n\nclass ProductAddUpdate extends React.Component {\n\n    state = {\n        options:[],\n    };\n\n    constructor(props) {\n        super();\n        this.pw = React.createRef()\n        this.editor =React.createRef()\n    }\n\n    submit = () =>{\n        this.props.form.validateFields(async (err,values)=>{\n            if(!err){\n                const {name,desc,price,categoryIds} =values\n                let pCategoryId,categoryId\n                if(categoryIds.length ===1){\n                    pCategoryId = '0'\n                    categoryId =categoryIds[0]\n                }else{\n                    pCategoryId = categoryIds[0]\n                    categoryId = categoryIds[1]\n                }\n\n                const imgs = this.pw.current.getImgs()\n                const detail = this.editor.current.getDetail()\n                const product = {name,desc,price,imgs,detail}\n                if(this.isUpdate){\n                    product._id = this.product._id\n                }\n                const result = await reqAddOrUpdateProduct(product)\n                if(result.status === 0){\n                    message.success(`${this.isUpdate}? '更新:'添加'商品成功!`)\n                    this.props.history.goBack()\n                }else{\n                    message.error(`${this.isUpdate}? '更新:'添加'商品失败!`)\n                }\n            }\n        })\n    }\n\n    validattorPrice = (rule,value,callback) =>{\n        if(value*1>0){\n            callback()\n        }else{\n            callback(\"价格格式不对\")\n        }\n\n    }\n\n    getCategory = async(parentId) =>{\n        const result  = await reqCategorys(parentId)\n        console.log(result.data.status);\n        if(result.data.status === \"0\"){\n            const categorys = result.data.data\n            if(parentId === \"0\"){\n                this.initOptions(categorys)\n            }else{\n                return categorys\n            }\n\n        }\n    }\n\n    initOptions =async (catagerys) =>{\n       const options = catagerys.map(c=>({\n            value: c._id,\n            label: c.name,\n            isLeaf: false,\n        }))\n\n        const {isUpdate,product} = this\n        const {pCategoryId,categoryId} =product\n        if(isUpdate && pCategoryId !== '0'){\n           const subCategorys = await this.getCategory(pCategoryId)\n            const childOptions = subCategorys.map(c=>({\n                value: c._id,\n                label: c.name,\n                isLeaf: false,\n            }))\n            const targetOption = options.find(option=>option.value == pCategoryId)\n            targetOption.children = childOptions\n\n        }\n        console.log(options)\n        this.setState({\n            options\n        })\n\n    }\n\n\n    loadData =  async selectedOptions => {\n        const targetOption = selectedOptions[0];\n        targetOption.loading = true;\n\n        const subCategory =  await this.getCategory(targetOption.value)\n        targetOption.loading = false;\n        if(subCategory && subCategory.length>0){\n               const childOptions = subCategory.map(c=>({\n                    value: c._id,\n                    label: c.name,\n                    isLeaf: true,\n                }))\n            targetOption.children = childOptions\n        }else{\n            targetOption.isLeaf = true;\n        }\n        // setTimeout(() => {\n        //     targetOption.loading = false;\n        //     targetOption.children = [\n        //         {\n        //             label: `${targetOption.label} Dynamic 1`,\n        //             value: 'dynamic1',\n        //         },\n        //         {\n        //             label: `${targetOption.label} Dynamic 2`,\n        //             value: 'dynamic2',\n        //         },\n        //     ];\n            this.setState({\n                options: [...this.state.options],\n            });\n        // }, 1000);\n    };\n\n\n    componentDidMount() {\n        this.getCategory('0')\n    }\n\n    componentWillMount() {\n        const product = this.props.location.state\n        this.isUpdate = !!product\n        this.product = product || {}\n    }\n\n\n    render(){\n        const {getFieldDecorator } = this.props.form\n        const {isUpdate,product} = this\n        const {pCategoryId,categoryId,imgs,detail} = product\n        const categoryIds = [];\n\n        if(isUpdate){\n            if(pCategoryId === '0'){\n                categoryIds.push(categoryId)\n            }else{\n                categoryIds.push(pCategoryId)\n                categoryIds.push(categoryId)\n            }\n\n        }\n\n        const title = (\n            <span>\n                <LinkButton onClick={()=>this.props.history.goBack()}>\n                    <Icon type=\"arrow-left\" style={{fontSize:20}}/>\n                </LinkButton>\n                <span>{isUpdate?'修改商品':'添加商品'}</span>\n            </span>\n        )\n\n        const formItemLayout = {\n            labelCol: { span: 2 },\n            wrapperCol: { span: 8},\n        };\n\n\n        return (\n            <Card title={title}>\n                <Form {...formItemLayout}>\n                    <Item label=\"商品名称:\">\n                        {\n                            getFieldDecorator('name',{\n                                initialValue:product.name,\n                                rules:[\n                                    {required:true,message:\"请输入商品名称\"}\n                                ]\n                            })(\n                                <Input placeholder=\"商品名称\"></Input>\n                            )\n                        }\n                    </Item>\n                    <Item label=\"商品描述:\">\n                        {\n                            getFieldDecorator('desc',{\n                                initialValue:product.desc,\n                                rules:[\n                                    {required:true,message:\"请输入商品描述\"}\n                                ]\n                            })(\n                                <TextArea  placeholder=\"商品描述\" autoSize ={{minRows:2}} />\n                            )\n                        }\n\n                    </Item>\n                    <Item label=\"商品价格:\">\n                        {\n                            getFieldDecorator('price',{\n                                initialValue:product.price,\n                                rules:[\n                                    {required:true,message:\"请输入商品描述\"},\n                                    {validator:this.validattorPrice}\n                                ]\n                            })(\n                                <Input type=\"number\" addonAfter=\"元\" placeholder=\"商品价格\"></Input>\n                            )\n                        }\n                    </Item>\n                    <Item label=\"商品分类:\">\n                        <div>商品分类</div>\n                    </Item>\n                    <Item label=\"商品分类:\">\n                        {\n                            getFieldDecorator('categoryIds',{\n                                initialValue:categoryIds,\n                                rules:[\n                                    {required:true,message:\"请输入商品分类\"}\n                                ]\n                            })(\n                                <Cascader\n                                    options={this.state.options}\n                                    loadData={this.loadData}\n                                    onChange={this.onChange}\n                                    changeOnSelect\n                                />\n                            )\n                        }\n\n\n                    </Item>\n                    <Item label=\"商品图片:\">\n                        <PicturesWall  ref={this.pw} imgs ={imgs} />\n                    </Item>\n                    <Item label=\"商品详情:\" labelCol={{ span: 2 }} wrapperCol={{ span: 20}}>\n                        <RichTextEditor  ref={this.editor} detail={detail} />\n                    </Item>\n\n                    <Item>\n                        <Button type=\"primary\" onClick={this.submit}>提交</Button>\n                    </Item>\n                </Form>\n            </Card>\n        )\n    }\n}\n\nexport default Form.create()(ProductAddUpdate);"]},"metadata":{},"sourceType":"module"}