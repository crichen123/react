{"ast":null,"code":"import\"antd/es/modal/style/css\";import _Modal from\"antd/es/modal\";import\"antd/es/upload/style/css\";import _Upload from\"antd/es/upload\";import\"antd/es/icon/style/css\";import _Icon from\"antd/es/icon\";import\"antd/es/message/style/css\";import _message from\"antd/es/message\";import _regeneratorRuntime from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/inherits\";import React from\"react\";import PropTypes from\"prop-types\";import{reqDeleteImg}from\"../../api\";import{BASE_IMG_URL}from\"../../utils/constant\";function getBase64(file){return new Promise(function(resolve,reject){var reader=new FileReader();reader.readAsDataURL(file);reader.onload=function(){return resolve(reader.result);};reader.onerror=function(error){return reject(error);};});}var PicturesWall=/*#__PURE__*/function(_React$Component){_inherits(PicturesWall,_React$Component);function PicturesWall(props){var _this;_classCallCheck(this,PicturesWall);_this=_possibleConstructorReturn(this,_getPrototypeOf(PicturesWall).call(this,props));_this.getImgs=function(){return _this.state.fileList.map(function(file){return file.name;});};_this.handleCancel=function(){return _this.setState({previewVisible:false});};_this.handlePreview=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(file){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!file.url&&!file.preview)){_context.next=4;break;}_context.next=3;return getBase64(file.originFileObj);case 3:file.preview=_context.sent;case 4:_this.setState({previewImage:file.url||file.preview,previewVisible:true});case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref3){var file,fileList,result,_result$data,name,url,_result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:file=_ref3.file,fileList=_ref3.fileList;if(!(file.status==='done')){_context2.next=6;break;}result=file.response;if(result.status===0){_message.success('上传成功');_result$data=result.data,name=_result$data.name,url=_result$data.url;file=fileList[fileList.length-1];file.name=name;file.url=url;}else{_message.error(\"上传失败\");}_context2.next=11;break;case 6:if(!(file.status==='removed')){_context2.next=11;break;}_context2.next=9;return reqDeleteImg(file.name);case 9:_result=_context2.sent;if(_result.status===0){_message.success(\"删除成功\");}else{_message.error(\"删除失败\");}case 11:_this.setState({fileList:fileList});case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();var _fileList=[];var imgs=_this.props.imgs;if(imgs&&imgs.length>0){_fileList=imgs.map(function(img,index){return{uid:-index,name:img,status:'done',url:BASE_IMG_URL+img};});}console.log(1111);console.log(_fileList);_this.state={previewVisible:false,previewImage:'',fileList:_fileList};return _this;}_createClass(PicturesWall,[{key:\"render\",value:function render(){var _this$state=this.state,previewVisible=_this$state.previewVisible,previewImage=_this$state.previewImage,fileList=_this$state.fileList;var uploadButton=React.createElement(\"div\",null,React.createElement(_Icon,{type:\"plus\"}),React.createElement(\"div\",{className:\"ant-upload-text\"},\"Upload\"));return React.createElement(\"div\",null,React.createElement(_Upload,{accept:\"image/*\",action:\"/users/upload\",listType:\"picture-card\",fileList:fileList,name:\"image\",onPreview:this.handlePreview,onChange:this.handleChange},fileList.length>=3?null:uploadButton),React.createElement(_Modal,{visible:previewVisible,footer:null,onCancel:this.handleCancel},React.createElement(\"img\",{alt:\"example\",style:{width:'100%'},src:previewImage})));}}]);return PicturesWall;}(React.Component);PicturesWall.protypes={imgs:PropTypes.array};export{PicturesWall as default};","map":{"version":3,"sources":["/home/crc/WebstormProjects/react-admin/src/pages/product/Pictures-wall.jsx"],"names":["React","PropTypes","reqDeleteImg","BASE_IMG_URL","getBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","PicturesWall","props","getImgs","state","fileList","map","name","handleCancel","setState","previewVisible","handlePreview","url","preview","originFileObj","previewImage","handleChange","status","response","success","data","length","imgs","img","index","uid","console","log","uploadButton","width","Component","protypes","array"],"mappings":"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","sourcesContent":["import React from \"react\";\n\nimport PropTypes from \"prop-types\"\nimport { Upload, Icon, Modal, message } from 'antd';\nimport {reqDeleteImg} from \"../../api\"\nimport {BASE_IMG_URL} from \"../../utils/constant\"\n\nfunction getBase64(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = error => reject(error);\n  });\n}\n\nexport default  class PicturesWall extends React.Component {\n\n\n  static protypes = {\n    imgs:PropTypes.array\n  }\n\n  constructor(props) {\n    super(props);\n    let fileList = [];\n    const {imgs} = this.props\n    if(imgs && imgs.length>0){\n      fileList =imgs.map(\n          (img,index)=>({\n             uid:-index,\n             name:img,\n             status:'done',\n            url:BASE_IMG_URL + img\n          }))\n    }\n    console.log(1111);\n    console.log(fileList);\n    this.state = {\n      previewVisible: false,\n      previewImage: '',\n      fileList: fileList,\n    }\n  }\n\n  getImgs = () =>{\n    return this.state.fileList.map(file=>file.name)\n  }\n\n  handleCancel = () => this.setState({ previewVisible: false });\n\n  handlePreview = async file => {\n    if (!file.url && !file.preview) {\n      file.preview = await getBase64(file.originFileObj);\n    }\n\n    this.setState({\n      previewImage: file.url || file.preview,\n      previewVisible: true,\n    });\n  };\n\n  handleChange = async({file, fileList }) => {\n    if(file.status === 'done'){\n      const result = file.response\n      if(result.status ===0){\n        message.success('上传成功')\n        const {name,url} = result.data\n        file = fileList[fileList.length-1]\n        file.name = name\n        file.url = url\n      }else{\n        message.error(\"上传失败\")\n      }\n    }else if(file.status === 'removed'){\n      const result =await  reqDeleteImg(file.name)\n      if(result.status === 0){\n        message.success(\"删除成功\")\n      }else{\n        message.error(\"删除失败\")\n      }\n    }\n    this.setState({ fileList })\n  };\n\n  render() {\n    const { previewVisible, previewImage, fileList } = this.state;\n    const uploadButton = (\n      <div>\n        <Icon type=\"plus\" />\n        <div className=\"ant-upload-text\">Upload</div>\n      </div>\n    );\n    return (\n      <div>\n        <Upload\n          accept=\"image/*\"\n          action=\"/users/upload\"\n          listType=\"picture-card\"\n          fileList={fileList}\n          name=\"image\"\n          onPreview={this.handlePreview}\n          onChange={this.handleChange}\n        >\n          {fileList.length >= 3 ? null : uploadButton}\n        </Upload>\n        <Modal visible={previewVisible} footer={null} onCancel={this.handleCancel}>\n          <img alt=\"example\" style={{ width: '100%' }} src={previewImage} />\n        </Modal>\n      </div>\n    );\n  }\n}\n\n"]},"metadata":{},"sourceType":"module"}