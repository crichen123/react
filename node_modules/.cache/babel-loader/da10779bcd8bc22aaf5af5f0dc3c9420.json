{"ast":null,"code":"import \"antd/es/card/style/css\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/modal/style/css\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/table/style/css\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style/css\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style/css\";\nimport _message from \"antd/es/message\";\nvar _jsxFileName = \"/home/crc/WebstormProjects/react-admin/src/pages/role/role.jsx\";\nimport React from 'react';\nimport { PAGE_SIZE } from \"../../utils/constant\";\nimport AddForm from \"./add-form\";\nimport AuthForm from \"./auth-form\";\nimport { reqAddUser, reqUpdateRole } from \"../../api\";\nimport memoryUtils from \"../../utils/memoryUtils\";\nimport { formateDate } from \"../../utils/dateUtils\";\nimport storageUtiles from \"../../utils/storageUtiles\";\nexport default class Role extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      roles: [{\n        \"menus\": [\"/home\", \"/products\", \"/category\", \"/product\", \"/role\"],\n        \"_id\": \"5ca9eac0\",\n        \"name\": \"角色1\",\n        \"create_time\": 1554639552758,\n        \"_v\": 0,\n        \"auth_time\": 1557630307021,\n        \"auth_name\": \"admim\"\n      }],\n      loading: false,\n      role: {},\n      isShowAdd: false,\n      isShowAuth: false\n    };\n\n    this.initColumn = () => {\n      this.columns = [{\n        title: '角色名称',\n        dataIndex: 'name'\n      }, {\n        title: '创建时间',\n        dataIndex: 'create_time',\n        render: creat_time => formateDate(creat_time)\n      }, {\n        title: '授权时间',\n        dataIndex: 'auth_time',\n        render: formateDate\n      }, {\n        title: '授权人',\n        dataIndex: 'auth_name'\n      }];\n    };\n\n    this.addRole = () => {\n      this.form.validateFields(async (err, values) => {\n        if (!err) {\n          this.setState({\n            isShowAdd: false\n          });\n          const {\n            roleName\n          } = values;\n          this.form.resetFields();\n          const result = await reqAddUser(roleName);\n\n          if (result.status === 0) {\n            _message.success(\"添加陈宫\");\n\n            const role = result.data;\n            this.setState(state => ({\n              roles: [...state.roles, role]\n            }));\n          } else {\n            _message.error(\"添加失败\");\n          }\n        }\n      });\n    };\n\n    this.updateRole = async () => {\n      this.setState({\n        isShowAuth: true\n      });\n      const role = this.state.role;\n      const menus = this.auth.current.getMenus;\n      role.menus = menus;\n      role.auth_name = memoryUtils.user.username;\n      role.auth_time = Date.now();\n      const result = await reqUpdateRole(role);\n\n      if (result.state === 0) {\n        _message.success(\"设置角色权限成功\");\n\n        if (role._id == memoryUtils.user.role._id) {\n          memoryUtils.user = {};\n          storageUtiles.removeUser();\n          this.props.history.replace('/login');\n        }\n\n        this.setState({\n          roles: [...this.state.roles]\n        });\n      } else {\n        _message.error(\"设置角色失败\");\n      }\n    };\n\n    this.handleCancel = () => {\n      this.setState({\n        isShowAdd: false\n      });\n      this.form.resetFields();\n    };\n\n    this.handleCancelAuth = () => {\n      this.setState({\n        isShowAuth: false\n      });\n    };\n\n    this.onRow = role => {\n      return {\n        onClick: event => {\n          this.setState({\n            role\n          });\n        }\n      };\n    };\n\n    this.auth = React.createRef();\n  }\n\n  componentWillMount() {\n    this.initColumn();\n  } // componentWillReceiveProps(nextProps, nextContext) {\n  //     console.log(nextProps.role);\n  //    // const menus = nextProps.role.menus\n  //    // this.state.checkedKeys = menus\n  // }\n\n\n  render() {\n    const {\n      roles,\n      loading,\n      role,\n      isShowAdd,\n      isShowAuth\n    } = this.state;\n    const title = React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, React.createElement(_Button, {\n      type: \"primary\",\n      onClick: () => this.setState({\n        isShowAdd: true\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }, \"\\u521B\\u5EFA\\u89D2\\u8272\"), \"\\xA0\\xA0\", React.createElement(_Button, {\n      type: \"primary\",\n      disabled: !role._id,\n      onClick: () => this.setState({\n        isShowAuth: true\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, \"\\u8BBE\\u7F6E\\u89D2\\u8272\\u6743\\u9650\"));\n    const rowSelection = {\n      type: 'radio',\n      selectedRowKeys: [role._id],\n      onSelect: role => {\n        this.setState({\n          role\n        });\n      }\n    };\n    return React.createElement(_Card, {\n      title: title,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }, React.createElement(_Table, {\n      bordered: true,\n      rowKey: \"_id\",\n      loadding: loading,\n      dataSource: roles,\n      columns: this.columns,\n      pagination: {\n        defaultPageSize: 5\n      },\n      rowSelection: rowSelection,\n      onRow: this.onRow,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }), React.createElement(_Modal, {\n      title: \"\\u6DFB\\u52A0\\u89D2\\u8272\",\n      visible: isShowAdd,\n      onOk: this.addRole,\n      onCancel: this.handleCancel,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }, React.createElement(AddForm, {\n      setForm: form => {\n        this.form = form;\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    })), React.createElement(_Modal, {\n      title: \"\\u8BBE\\u7F6E\\u6743\\u9650\",\n      visible: isShowAuth,\n      onOk: this.updateRole,\n      onCancel: this.handleCancelAuth,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }, React.createElement(AuthForm, {\n      ref: this.auth,\n      role: role,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    })));\n  }\n\n}","map":{"version":3,"sources":["/home/crc/WebstormProjects/react-admin/src/pages/role/role.jsx"],"names":["React","PAGE_SIZE","AddForm","AuthForm","reqAddUser","reqUpdateRole","memoryUtils","formateDate","storageUtiles","Role","Component","constructor","props","state","roles","loading","role","isShowAdd","isShowAuth","initColumn","columns","title","dataIndex","render","creat_time","addRole","form","validateFields","err","values","setState","roleName","resetFields","result","status","success","data","error","updateRole","menus","auth","current","getMenus","auth_name","user","username","auth_time","Date","now","_id","removeUser","history","replace","handleCancel","handleCancelAuth","onRow","onClick","event","createRef","componentWillMount","rowSelection","type","selectedRowKeys","onSelect","defaultPageSize"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {Button, Table, Card, Modal,message} from \"antd\"\nimport {PAGE_SIZE} from \"../../utils/constant\";\nimport AddForm from \"./add-form\";\nimport AuthForm from \"./auth-form\";\nimport {reqAddUser,reqUpdateRole} from \"../../api\";\nimport memoryUtils from \"../../utils/memoryUtils\";\nimport {formateDate} from \"../../utils/dateUtils\";\nimport storageUtiles from \"../../utils/storageUtiles\";\n\nexport default class Role extends React.Component {\n    state = {\n        roles:[{\n            \"menus\":[\n                \"/home\",\n                \"/products\",\n                \"/category\",\n                \"/product\",\n                \"/role\"\n            ],\n            \"_id\":\"5ca9eac0\",\n            \"name\":\"角色1\",\n            \"create_time\":1554639552758,\n            \"_v\":0,\n            \"auth_time\":1557630307021,\n            \"auth_name\":\"admim\"\n        }],\n        loading:false,\n        role:{},\n        isShowAdd:false,\n        isShowAuth:false\n    }\n\n    constructor(props) {\n        super(props);\n        this.auth = React.createRef()\n    }\n\n    initColumn = () =>{\n        this.columns = [\n            {\n                title:'角色名称',\n                dataIndex:'name'\n            }, {\n                title:'创建时间',\n                dataIndex:'create_time',\n                render:(creat_time)=>formateDate(creat_time)\n            },{\n                title:'授权时间',\n                dataIndex:'auth_time',\n                render:formateDate\n            },{\n                title:'授权人',\n                dataIndex:'auth_name'\n            },\n        ]\n    }\n\n    addRole =() =>{\n        this.form.validateFields(async(err,values)=>{\n            if(!err){\n                this.setState({isShowAdd:false})\n                const {roleName} = values\n                this.form.resetFields()\n                const result = await reqAddUser(roleName)\n                if(result.status===0){\n                    message.success(\"添加陈宫\")\n                    const role = result.data\n                    this.setState(state=>({\n                        roles:[...state.roles,role]\n                    }))\n\n                }else{\n                    message.error(\"添加失败\")\n                }\n            }\n        })\n    }\n\n    updateRole = async() =>{\n        this.setState({\n            isShowAuth:true\n        })\n        const role = this.state.role\n        const menus = this.auth.current.getMenus\n        role.menus = menus\n        role.auth_name = memoryUtils.user.username\n        role.auth_time = Date.now()\n        const result = await reqUpdateRole(role)\n        if(result.state===0){\n            message.success(\"设置角色权限成功\")\n            if(role._id == memoryUtils.user.role._id){\n                memoryUtils.user ={}\n                storageUtiles.removeUser()\n                this.props.history.replace('/login')\n            }\n            this.setState({\n                roles:[...this.state.roles]\n            })\n        }else{\n            message.error(\"设置角色失败\")\n        }\n\n    }\n\n    handleCancel =()=>{\n        this.setState({isShowAdd:false})\n        this.form.resetFields()\n    }\n\n    handleCancelAuth =()=>{\n        this.setState({isShowAuth:false})\n\n    }\n\n    onRow = (role)=>{\n        return {\n            onClick : event=>{\n                this.setState({\n                    role\n                })\n            }\n        }\n    }\n\n\n    componentWillMount(){\n        this.initColumn()\n    }\n\n    // componentWillReceiveProps(nextProps, nextContext) {\n    //     console.log(nextProps.role);\n    //    // const menus = nextProps.role.menus\n    //    // this.state.checkedKeys = menus\n    // }\n\n\n    render(){\n        const {roles,loading,role,isShowAdd,isShowAuth} = this.state\n\n        const title=(\n            <span>\n                    <Button type=\"primary\" onClick={()=>this.setState({isShowAdd: true})}>创建角色</Button>&nbsp;&nbsp;\n                    <Button type=\"primary\" disabled={!role._id} onClick={()=>this.setState({isShowAuth: true})}>设置角色权限</Button>\n            </span>\n        )\n\n        const rowSelection = ({\n            type:'radio',\n            selectedRowKeys:[role._id],\n            onSelect:(role)=>{\n                this.setState({\n                    role\n                })\n            }\n        })\n\n\n\n        return (\n            <Card title={title} >\n                <Table\n                    bordered\n                    rowKey=\"_id\"\n                    loadding={loading}\n                    dataSource={roles}\n                    columns={this.columns}\n                    pagination={{defaultPageSize:5}}\n                    rowSelection={rowSelection}\n                    onRow={this.onRow}\n                 />\n                <Modal\n                    title=\"添加角色\"\n                    visible={isShowAdd}\n                    onOk={this.addRole}\n                    onCancel={this.handleCancel}\n                >\n                    <AddForm  setForm={(form)=> {this.form = form} } />\n                </Modal>\n\n                <Modal\n                    title=\"设置权限\"\n                    visible={isShowAuth}\n                    onOk={this.updateRole}\n                    onCancel={this.handleCancelAuth}\n                >\n                    <AuthForm ref={ this.auth} role={role} />\n                </Modal>\n            </Card>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}