{"ast":null,"code":"import\"antd/es/card/style/css\";import _Card from\"antd/es/card\";import\"antd/es/table/style/css\";import _Table from\"antd/es/table\";import\"antd/es/button/style/css\";import _Button from\"antd/es/button\";import\"antd/es/modal/style/css\";import _Modal from\"antd/es/modal\";import _regeneratorRuntime from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/regenerator\";import\"antd/es/message/style/css\";import _message from\"antd/es/message\";import _asyncToGenerator from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/crc/WebstormProjects/react-admin/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import{PAGE_SIZE}from\"../../utils/constant\";import{formateDate}from\"../../utils/dateUtils\";import LinkButton from\"../../components/link-button\";import UserForm from\"./user-form\";import{reqGetUsers,reqDeleUser,reqAddUser}from\"../../api\";var User=/*#__PURE__*/function(_React$Component){_inherits(User,_React$Component);function User(){var _getPrototypeOf2;var _this;_classCallCheck(this,User);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(User)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={loading:false,users:[{\"username\":\"text\",\"_id\":\"548542421\",\"create_time\":1554639552758,\"email\":\"test@aadfa.conm\",\"phone\":\"15712548\",\"role_id\":\"fdsa854854\",\"password\":\"12312312\"}],roles:[{\"_id\":\"fdsa854854\",\"name\":\"测试\"}],isShow:false};_this.initColumn=function(){_this.columns=[{title:'用户明',dataIndex:\"username\"},{title:\"邮箱\",dataIndex:\"email\"},{title:\"电话\",dataIndex:\"phone\"},{title:\"注册时间\",dataIndex:\"create_time\",render:formateDate},{title:\"所属角色\",dataIndex:\"role_id\",render:function render(role_id){return _this.state.roles.find(function(role){return role._id===role_id;}).name;}// render:(role_id)=>this.roleNames[role_id]\n},{title:\"操作\",render:function render(user){return React.createElement(\"span\",null,React.createElement(LinkButton,{onClick:function onClick(){return _this.showUpdate(user);}},\"\\u4FEE\\u6539\"),React.createElement(LinkButton,{onClick:function onClick(){return _this.deleteUser(user);}},\"\\u5220\\u9664\"));}}];};_this.showUpdate=function(user){_this.user=user;_this.setState({isShow:true});};_this.showAdd=function(){_this.user=null;_this.setState({isShow:true});};_this.addOrUpdateUser=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var user,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this.setState({isshow:false});user=_this.form.getFieldsValue();_this.form.resetFields();_context.next=5;return reqAddUser(user);case 5:result=_context.sent;if(result.static===0){_message.success(\"添加成功\");_this.getUsers();}case 7:case\"end\":return _context.stop();}}},_callee);}));_this.deleteUser=function(user){_Modal.confirm({title:\"确定要删除用户\"+user.username+\"?\",onOk:function(){var _onOk=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return reqDeleUser(user._id);case 2:result=_context2.sent;if(result.status===0){_message.success(\"删除用户成功\");_this.getUsers();}case 4:case\"end\":return _context2.stop();}}},_callee2);}));function onOk(){return _onOk.apply(this,arguments);}return onOk;}()});};_this.initRoleNames=function(roles){var roleNames=roles.reduce(function(pre,role){pre[role._id]=role.name;return pre;},[]);_this.roleNames=roleNames;};_this.getUsers=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var result,_result$data,users,roles;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return reqGetUsers();case 2:result=_context3.sent;if(result.status===0){_result$data=result.data,users=_result$data.users,roles=_result$data.roles;_this.initRoleNames(roles);_this.setState({users:users,roles:roles});}case 4:case\"end\":return _context3.stop();}}},_callee3);}));return _this;}_createClass(User,[{key:\"componentDidMount\",value:function componentDidMount(){this.initColumn();this.getUsers();}},{key:\"render\",value:function render(){var _this2=this;var title=React.createElement(_Button,{type:\"primary\",onClick:function onClick(){return _this2.showAdd();}},\"\\u521B\\u5EFA\\u7528\\u6237\");var _this$state=this.state,loading=_this$state.loading,users=_this$state.users,isShow=_this$state.isShow,roles=_this$state.roles;var user=this.user;return React.createElement(_Card,{title:title},React.createElement(_Table,{bordered:true,rowKey:\"_id\",loadding:loading,dataSource:users,pagination:{defaultPageSize:5},columns:this.columns}),React.createElement(_Modal,{title:user?'修改用户':\"添加用户\",visible:isShow,onOk:this.addOrUpdateUser,onCancel:function onCancel(){_this2.form.resetFields();_this2.setState({isShow:false});}},React.createElement(UserForm,{user:user,setForm:function setForm(form){return _this2.form=form;},roles:roles},\"1111\")));}}]);return User;}(React.Component);export{User as default};","map":{"version":3,"sources":["/home/crc/WebstormProjects/react-admin/src/pages/user/user.jsx"],"names":["React","PAGE_SIZE","formateDate","LinkButton","UserForm","reqGetUsers","reqDeleUser","reqAddUser","User","state","loading","users","roles","isShow","initColumn","columns","title","dataIndex","render","role_id","find","role","_id","name","user","showUpdate","deleteUser","setState","showAdd","addOrUpdateUser","isshow","form","getFieldsValue","resetFields","result","static","success","getUsers","confirm","username","onOk","status","initRoleNames","roleNames","reduce","pre","data","defaultPageSize","Component"],"mappings":"0qCAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CAEA,OAAQC,SAAR,KAAwB,sBAAxB,CACA,OAAQC,WAAR,KAA0B,uBAA1B,CACA,MAAOC,CAAAA,UAAP,KAAuB,8BAAvB,CACA,MAAOC,CAAAA,QAAP,KAAqB,aAArB,CACA,OAAQC,WAAR,CAAoBC,WAApB,CAAgCC,UAAhC,KAAiD,WAAjD,C,GAEqBC,CAAAA,I,mYAEjBC,K,CAAQ,CACJC,OAAO,CAAC,KADJ,CAEJC,KAAK,CAAC,CAAC,CACH,WAAW,MADR,CAEH,MAAM,WAFH,CAGH,cAAc,aAHX,CAIH,QAAQ,iBAJL,CAKH,QAAQ,UALL,CAMH,UAAU,YANP,CAOH,WAAW,UAPR,CAAD,CAFF,CAWJC,KAAK,CAAC,CAAC,CACH,MAAM,YADH,CAEH,OAAO,IAFJ,CAAD,CAXF,CAeJC,MAAM,CAAC,KAfH,C,OAmBRC,U,CAAa,UAAI,CACb,MAAKC,OAAL,CAAe,CAAC,CACZC,KAAK,CAAC,KADM,CAEZC,SAAS,CAAC,UAFE,CAAD,CAGb,CACED,KAAK,CAAC,IADR,CAEEC,SAAS,CAAE,OAFb,CAHa,CAMb,CACED,KAAK,CAAC,IADR,CAEEC,SAAS,CAAE,OAFb,CANa,CASb,CACED,KAAK,CAAC,MADR,CAEEC,SAAS,CAAE,aAFb,CAGEC,MAAM,CAAChB,WAHT,CATa,CAab,CACEc,KAAK,CAAC,MADR,CAEEC,SAAS,CAAE,SAFb,CAGCC,MAAM,CAAC,gBAACC,OAAD,QAAW,OAAKV,KAAL,CAAWG,KAAX,CAAiBQ,IAAjB,CAAsB,SAAAC,IAAI,QAAEA,CAAAA,IAAI,CAACC,GAAL,GAAaH,OAAf,EAA1B,EAAkDI,IAA7D,EACP;AAJD,CAba,CAkBb,CACEP,KAAK,CAAC,IADR,CAECE,MAAM,CAAC,gBAACM,IAAD,QACN,iCACI,oBAAC,UAAD,EAAY,OAAO,CAAE,yBAAI,OAAKC,UAAL,CAAgBD,IAAhB,CAAJ,EAArB,iBADJ,CAEI,oBAAC,UAAD,EAAY,OAAO,CAAE,yBAAI,OAAKE,UAAL,CAAgBF,IAAhB,CAAJ,EAArB,iBAFJ,CADM,EAFR,CAlBa,CAAf,CA4BH,C,OAEDC,U,CAAa,SAACD,IAAD,CAAS,CAClB,MAAKA,IAAL,CAAYA,IAAZ,CACA,MAAKG,QAAL,CAAc,CAACd,MAAM,CAAC,IAAR,CAAd,EACH,C,OAEDe,O,CAAU,UAAK,CACX,MAAKJ,IAAL,CAAY,IAAZ,CACA,MAAKG,QAAL,CAAc,CAACd,MAAM,CAAC,IAAR,CAAd,EACH,C,OAIDgB,e,sEAAkB,mJACd,MAAKF,QAAL,CAAc,CAACG,MAAM,CAAC,KAAR,CAAd,EACMN,IAFQ,CAED,MAAKO,IAAL,CAAUC,cAAV,EAFC,CAGd,MAAKD,IAAL,CAAUE,WAAV,GAHc,sBAIQ1B,CAAAA,UAAU,CAACiB,IAAD,CAJlB,QAIRU,MAJQ,eAKd,GAAGA,MAAM,CAACC,MAAP,GAAkB,CAArB,CAAwB,CACpB,SAAQC,OAAR,CAAgB,MAAhB,EACA,MAAKC,QAAL,GACH,CARa,sD,SAYlBX,U,CAAY,SAACF,IAAD,CAAS,CACjB,OAAMc,OAAN,CAAc,CACVtB,KAAK,CAAC,UAAUQ,IAAI,CAACe,QAAf,CAAwB,GADpB,CAEVC,IAAI,8EAAC,0KACmBlC,CAAAA,WAAW,CAACkB,IAAI,CAACF,GAAN,CAD9B,QACKY,MADL,gBAED,GAAGA,MAAM,CAACO,MAAP,GAAkB,CAArB,CAAuB,CACnB,SAAQL,OAAR,CAAgB,QAAhB,EACA,MAAKC,QAAL,GACH,CALA,wDAAD,sEAFM,CAAd,EAUH,C,OAEDK,a,CAAgB,SAAC9B,KAAD,CAAW,CACvB,GAAO+B,CAAAA,SAAS,CAAG/B,KAAK,CAACgC,MAAN,CAAa,SAACC,GAAD,CAAKxB,IAAL,CAAY,CACxCwB,GAAG,CAACxB,IAAI,CAACC,GAAN,CAAH,CAAgBD,IAAI,CAACE,IAArB,CACA,MAAOsB,CAAAA,GAAP,CACH,CAHkB,CAGjB,EAHiB,CAAnB,CAIA,MAAKF,SAAL,CAAiBA,SAAjB,CACH,C,OAEDN,Q,sEAAW,mMACchC,CAAAA,WAAW,EADzB,QACD6B,MADC,gBAEP,GAAGA,MAAM,CAACO,MAAP,GAAkB,CAArB,CAAuB,cACGP,MAAM,CAACY,IADV,CACZnC,KADY,cACZA,KADY,CACNC,KADM,cACNA,KADM,CAEnB,MAAK8B,aAAL,CAAmB9B,KAAnB,EACA,MAAKe,QAAL,CAAc,CACVhB,KAAK,CAALA,KADU,CACJC,KAAK,CAALA,KADI,CAAd,EAGH,CARM,wD,+FAaS,CAChB,KAAKE,UAAL,GACA,KAAKuB,QAAL,GACH,C,uCAEO,iBACJ,GAAMrB,CAAAA,KAAK,CAAI,6BAAQ,IAAI,CAAC,SAAb,CAAuB,OAAO,CAAE,yBAAI,CAAA,MAAI,CAACY,OAAL,EAAJ,EAAhC,6BAAf,CADI,gBAEiC,KAAKnB,KAFtC,CAEGC,OAFH,aAEGA,OAFH,CAEWC,KAFX,aAEWA,KAFX,CAEiBE,MAFjB,aAEiBA,MAFjB,CAEwBD,KAFxB,aAEwBA,KAFxB,CAGJ,GAAMY,CAAAA,IAAI,CAAG,KAAKA,IAAlB,CACA,MAEI,4BAAM,KAAK,CAAER,KAAb,EACI,4BACI,QAAQ,KADZ,CAEI,MAAM,CAAC,KAFX,CAGI,QAAQ,CAAEN,OAHd,CAII,UAAU,CAAEC,KAJhB,CAKI,UAAU,CAAG,CAACoC,eAAe,CAAC,CAAjB,CALjB,CAMI,OAAO,CAAE,KAAKhC,OANlB,EADJ,CAQI,4BACI,KAAK,CAAES,IAAI,CAAC,MAAD,CAAQ,MADvB,CAEI,OAAO,CAAEX,MAFb,CAGI,IAAI,CAAE,KAAKgB,eAHf,CAII,QAAQ,CAAE,mBAAI,CACV,MAAI,CAACE,IAAL,CAAUE,WAAV,GACA,MAAI,CAACN,QAAL,CAAc,CAACd,MAAM,CAAE,KAAT,CAAd,EACH,CAPL,EASI,oBAAC,QAAD,EAAU,IAAI,CAAEW,IAAhB,CAAsB,OAAO,CAAE,iBAAAO,IAAI,QAAE,CAAA,MAAI,CAACA,IAAL,CAAYA,IAAd,EAAnC,CAAuD,KAAK,CAAEnB,KAA9D,SATJ,CARJ,CAFJ,CAyBH,C,kBAhJ6BZ,KAAK,CAACgD,S,SAAnBxC,I","sourcesContent":["import React from 'react'\nimport {Modal, Card, Button, Table, message} from \"antd\"\nimport {PAGE_SIZE} from \"../../utils/constant\";\nimport {formateDate} from \"../../utils/dateUtils\";\nimport LinkButton from \"../../components/link-button\";\nimport UserForm from \"./user-form\";\nimport {reqGetUsers,reqDeleUser,reqAddUser} from \"../../api\"\n\nexport default class User extends React.Component {\n\n    state = {\n        loading:false,\n        users:[{\n            \"username\":\"text\",\n            \"_id\":\"548542421\",\n            \"create_time\":1554639552758,\n            \"email\":\"test@aadfa.conm\",\n            \"phone\":\"15712548\",\n            \"role_id\":\"fdsa854854\",\n            \"password\":\"12312312\"\n        }],\n        roles:[{\n            \"_id\":\"fdsa854854\",\n            \"name\":\"测试\"\n        }],\n        isShow:false,\n\n    }\n\n    initColumn = ()=>{\n        this.columns = [{\n            title:'用户明',\n            dataIndex:\"username\"\n        },{\n            title:\"邮箱\",\n            dataIndex: \"email\"\n        },{\n            title:\"电话\",\n            dataIndex: \"phone\"\n        },{\n            title:\"注册时间\",\n            dataIndex: \"create_time\",\n            render:formateDate\n        },{\n            title:\"所属角色\",\n            dataIndex: \"role_id\",\n           render:(role_id)=>this.state.roles.find(role=>role._id === role_id).name\n           // render:(role_id)=>this.roleNames[role_id]\n        },{\n            title:\"操作\",\n           render:(user)=>(\n            <span>\n                <LinkButton onClick={()=>this.showUpdate(user)}>修改</LinkButton>\n                <LinkButton onClick={()=>this.deleteUser(user)}>删除</LinkButton>\n            </span>\n           )\n        }\n        ]\n    }\n\n    showUpdate = (user) =>{\n        this.user = user\n        this.setState({isShow:true})\n    }\n\n    showAdd = () =>{\n        this.user = null\n        this.setState({isShow:true})\n    }\n\n\n\n    addOrUpdateUser = async() =>{\n        this.setState({isshow:false})\n        const user = this.form.getFieldsValue()\n        this.form.resetFields()\n        const result = await  reqAddUser(user);\n        if(result.static === 0) {\n            message.success(\"添加成功\")\n            this.getUsers()\n        }\n\n    }\n\n    deleteUser =(user) =>{\n        Modal.confirm({\n            title:\"确定要删除用户\"+user.username+\"?\",\n            onOk:async()=>{\n                const result =await reqDeleUser(user._id)\n                if(result.status === 0){\n                    message.success(\"删除用户成功\")\n                    this.getUsers()\n                }\n            }\n        })\n    }\n\n    initRoleNames = (roles) => {\n        const  roleNames = roles.reduce((pre,role)=>{\n            pre[role._id] = role.name\n            return pre\n        },[])\n        this.roleNames = roleNames\n    }\n\n    getUsers = async() => {\n        const result = await reqGetUsers();\n        if(result.status === 0){\n            const {users,roles} = result.data\n            this.initRoleNames(roles)\n            this.setState({\n                users,roles\n            })\n        }\n\n    }\n\n\n    componentDidMount() {\n        this.initColumn()\n        this.getUsers()\n    }\n\n    render(){\n        const title = (<Button type=\"primary\" onClick={()=>this.showAdd()}>创建用户</Button>);\n        const {loading,users,isShow,roles} = this.state\n        const user = this.user\n        return (\n\n            <Card title={title}>\n                <Table\n                    bordered\n                    rowKey=\"_id\"\n                    loadding={loading}\n                    dataSource={users}\n                    pagination={ {defaultPageSize:5} }\n                    columns={this.columns} />\n                <Modal\n                    title={user?'修改用户':\"添加用户\"}\n                    visible={isShow}\n                    onOk={this.addOrUpdateUser}\n                    onCancel={()=>{\n                        this.form.resetFields();\n                        this.setState({isShow: false})\n                    }}\n                >\n                    <UserForm user={user} setForm={form=>this.form = form} roles={roles}>1111</UserForm>\n                </Modal>\n\n\n            </Card>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}